---
title: 事情多到爆炸也想折腾一下家里的网络
date: 2021-08-23 21:02:33
categories: 其他
tags: 计算机网络 组网
---

![](/img/network/router.jpg.webp.webp)

最近事情多到抑郁, 但是我这种佛人再忙也要绞尽脑汁想点没用的事给自己做.

<!--more-->

为了让家里各个角落都有wifi用并且有个地方能跑一些奇怪的网络服务, 我一两年前搞了个工控机当软路由用, D2550+从高一买的神船上拆下来的4g内存条刷了个openwrt系统, 我之前写玩具Ray Tracer的时候还在这个神机上出过一张图.

我们家之前是router+3AP结构, 主路由是那个软路由, 然后还有三个硬路由当AP用. 其中一个AP是无线桥接上去, 另外两个是有线桥接. 后来无线桥接的路由器死了, 也懒得补上去, 就保持着router+2AP的结构了.

光纤进来的时候接进了一个光猫, 这个光猫应该是集成了调制解调器和无线路由器的功能, 而且强制把PPPoE拨号放在了这上面. 但是这玩意一看就属于性能羸弱的类型, 而且这个超级密码应该是联网自动更新的. 我去恩山上面找到个在安徽移动上班的大神, 查到了自己家光猫的超级密码, 进去反手改一个桥接.

然后用主路由WAN口连上光猫的LAN, 把拨号, DHCP服务器和一些奇怪的服务全部搬到了主路由上. 然后主路由的LAN接到AP1的LAN, AP1的另一个LAN接到AP2的LAN上, 相当于把这俩硬路由当成了交换机用, 全家都在一个网段(192.168.8.1/24).

![](/img/network/topo_1.png.webp.webp)

(众所周知, 邦邦是路由器)

现在遇到的问题就是, AP1, 也就是在我卧室的这个硬路由, 他只有两个LAN口, 全部都被用了. 现在我想把一个台式机放在这里有线接入都没有地方接了.

现在初步一想, 有两个方法:
- 在软件层面上把AP1的WAN口强行改成LAN口.
- 把AP1和AP2调换一下位置, AP2的LAN口多.

第一个方法硬路由的原生固件肯定是不支持的, 如果想要做的话, 需要给这个硬路由也刷上openwrt才有可能. 刷硬路由太折磨人了, 而且固件还有可能出问题, 所以就放弃了.

看起来第二种方法好像更简单一点, 按理说, 我只需要把这俩路由器调换一下位置, 连管理界面都不需要进. 但是我们家两个AP的的wifi的SSID不一样, 为了让wifi还停留在原地, 我还想调换AP的同时把这俩wifi的SSID调换一下.

这时候我遇到一个大问题, 我忘了两个硬路由的LAN口地址了. 因为是桥接网络, 所以两个硬路由的DHCP服务器一定是要关掉的, 这样我就真不知道怎么拿到他们的IP地址了/dx.

只能把两个路由器重置一下, 默认他们的DHCP服务器是开的, 用个网线直接连电脑就能拿到网关地址, 然后就能进管理界面了.

进去之后关DHCP, 设置两个硬路由LAN口地址分别为192.168.8.2和192.168.8.3, 192.168.8.1是给主路由用的. 把SSID换一下, 就完成了.

灵异事件出现了, 之前工作的好好的超长网线这时候不起作用了, 超长网线另一端的AP根本访问不到主路由. 我以为是超长网线的问题, 但是我把超长网线接到光猫的LAN口上的时候, 那边AP接入的设备甚至还能分到光猫里DHCP服务器分来的192.168.1.1网段的IP.

合理推断, 应该是换来的这个硬路由的问题, "带不动"这根长网线. 无奈, 只好再换回来.

然后再想有没有第三种方法. 我想如果把拨号的任务交给这个硬路由, 然后DHCP和其他服务还是交给软路由做, 但是软路由只用一根网线接到主硬路由LAN上, 主硬路由的另一个LAN口还接AP2. 这样主硬路由的WAN就被利用上了, 接在了光猫上. 而这里多利用的一个口就会导致软路由上少用一个口, 软路由以前的WAN口现在是空闲的, 成了一个单臂路由. 但是因为软路由是openwrt系统, 他的WAN和LAN可以在软件上定义, 我可以把剩下这个WAN改成LAN, 这样就多了一个可以利用的LAN口了. 我们家最大带机量应该是10个左右, 我感觉这对硬路由来说应该问题不大. 唯一的缺点就是这样在千兆链路上最大只能跑500Mbps, 不过这对我们家够了.

![](/img/network/topo_2.png.webp.webp)

然后遇到一个离谱的问题, 搭好结构后, 本来就挺完美的, 就是感觉好像上网稍微有点慢, 就没注意. 过了一会QQ电话打不了, 上国内网站贼慢, 再过一会直接qq发不了消息, 但是可以收消息, 国内网站也上不了. 找了一圈, 把下面这俩拒绝改成了接受就没事了, 现在也不知道是为什么.

![](/img/network/openwrt.png.webp.webp)

加入了xsh的zerotier网络, 在他失去了屏幕的游戏本上开了虚拟机, 渲染了一张图.
![](/img/network/xsh.jpg.webp.webp)

